# 5조 프로젝트 : 라즈베리 파이를 활용한 IoT 기기 해킹

#### 5조 조원
- 산업보안학과 김성규
- 산업보안학과 박대용
- 산업보안학과 이우성

### 사용 기기
 - 라즈베리 파이Zero WH 모델
 - 라즈베리 파이 카메라 제로 v 1.3

## (1) CCTV

- 라즈베리 파이 기기가 IoT CCTV라고 가정하여 프로젝트를 진행했습니다.
- 라즈베리 파이 카메라를 연결하여 camerashot.py 프로그램을 통해 자동으로 30분마다 사진을 촬영하도록 세팅했습니다.
- CCTV 기기 내에 촬영한 파일들이 날짜별로 저장되어 있고
- 사진들이 저장된 파일 내에 백도어 프로그램을 심어놔서 공격자가 SSH 연결을 통해 IoT CCTV 기기에 연결하지 않더라도, 백도어 프로그램이 지정된 IP와 포트의 주소로 공격자가 원할 때 CCTV 기기가 저장하고 있는 사진들을 전송하는 프로그램을 구현했습니다
- 역시 python의 소켓 API를 사용하여 프로그램을 구현했습니다.

### - backdoor.py
##### 2020.05.27
ver 1.0
- CCTV 사진들이 저장된 디렉토리 내에 존재하는 프로그램입니다
- python의 os 라이브러리를 사용하여 자신이 존재하는 디렉토리와 서브디렉토리 정보를 획득한 뒤 해당 디렉토리에 저장된 정보들을 전송하는 프로그램입니다

##### 2020.06.10
ver 1.5

- master.py에서 파일을 전송받을 때 버퍼의 크기 문제로 인해 여러 사진이 하나의 파일로 저장되는 문제를 피드백으로 받았습니다.
- 이를 해결하기 위해서 backdoor.py에서 사진을 보낼 때 사진을 보내기 전에 사진의 크기를 전송하고, master.py는 전달받은 사진의 크기만큼 데이터를 받은 뒤 이를 파일에 저장하고 그 다음 사진을 받는 방법으로 구현했습니다
##### 보완점(To-Do List)
- 원래 목표는 최초 SSH 접속을 통해 사용자의 라즈베리 파이 기기에 backdoor.py 파일을 설치한 다음 
- 추가적인 SSH 접속 없이도 원격지에서 실행되는 master.py 프로그램에서 전송하는 명령을 통해 공격자의 의도대로 IoT 기기에 저장된 사진을 가져오는 프로그램을 설계하는 것이었습니다.
- 하지만 실제로 프로그램을 구현하다보니 IoT 기기가 하나의 공인 IP 내부에서 사설 IP를 사용하고, 이 사설 IP가 언제든지 바뀔 수 있을 뿐만 아니라
- backdoor.py 프로그램에서 사용하는 포트에 대한 포트포워딩 역시 사전에 필요하는 등 부가적으로 설정해야하는 기능들이 있는데 이러한 점들까지 해킹 시나리오 혹은 프로그램 내부에서 해결할 수 있도록 구현해야하는 보완점이 있습니다.

### - master.py
##### 2020.05.27
ver 1.0
- 원격으로 데이터를 전송받는 프로그램입니다
- 1시간에 한 번씩 backdoor.py 프로그램에게 'get' 메시지를 전송하여 백도어가 존재하는 디렉토리의 정보들을 전송받아 저장하는 프로그램입니다.

##### 2020.06.10
ver 1.5
- 여러 장의 사진이 하나의 사진으로 저장되는 문제를 해결하기 위해 backdoor.py로부터 전달받는 사진의 크기를 먼저 전송받은 다음,
그 크기와 recv를 통해 저장하는 데이터의 크기가 같을 때 까지 데이터를 전송받아 파일을 저장하는 방식으로 변경했습니다.
- json과 일반 바이너리를 번갈아가면서 데이터를 주고받는데, 전송 속도의 차이 때문인지 json 데이터 타입을 읽어들여야 할 때 바이너리 데이터가 먼저 도착해서 데이터 타입 에러가 발생하는 경우가 많았습니다.
- 이를 해결하기 위해 코드 중간중간에 time.sleep을 통해 일정 부분 에러 발생을 막아보려고 했지만 아직 안전성 부분에서 완벽하지 않습니다.
##### 보완점(To-Do List)
- 

### - camerashot.py
ver 1.5

- backdoor.py 프로그램에서 사진을 가져올 때 실제로 IoT 기기에서 촬영한 사진을 사용해보기 위해 만든 프로그램입니다.
- 파이썬 파이 카메라 모듈을 사용해서 라즈베리 파이에 연결된 파이 카메라에 명령을 내려서 30분에 한 번씩 10장의 사진을 촬영하는 프로그램입니다.
##### 보완점(To-Do List)
- 최종 발표 프로그램에서는 단순히 사진을 촬영하는 수준까지 프로그램을 구현했습니다.
- 하지만 실제 CCTV라면 사진 촬영이 아닌 영상을 촬영하고, 정해진 시간별로 영상을 저장하는 수준까지 구현을 해야합니다.
- 뿐만 아니라 파이썬의 openCV 라이브러리를 사용해서 라즈베리 파이 내부적으로 영상을 실시간으로 분석해서 등록되지 않거나 낯선 사람의 얼굴이 포착되면 지정된 사용자에게 알림을 보내주는 기능까지 구현을 할 수 있다면 좋을 것 같습니다.

### (2) Airconditioner
2020.05.27
ver 1.0
- 라즈베리 파이 기기가 IoT 에어컨이라고 가정하여 만든 프로그램입니다
- 온도 센서 기기가 없어 처음엔 라즈베리 파이 기기 자체에서 웹 크롤링을 통해 기온 정보와 미세먼지
정보를 수집하려고 했습니다
- 하지만 라즈베리 파이 기기와 운영체제의 성능 제한으로 인해(Raspbian Buster Liter) 라즈베리 파이 자체에서 직접 브라우저를 사용하여 웹 크롤링을 실행하는 건 무리라고 판단되어
- 메인 PC(노트북)에서 웹 크롤링을 통해 날씨 정보와 미세먼지 정보를 수집한 뒤(Client)
- 파이썬의 소켓 API를 사용하여 수집한 정보를 라즈베리 파이(Server)에게 전달하는 프로그램을 작성했습니다.
#### - SendWeatherInfo.py

- 메인 PC(노트북)에서 웹 크롤링을 통해 날씨 정보와 미세먼지 정보를 수집해서 라즈베리 파이 기기에서 작동하는 GetData.py 프로그램에게 전송하는 프로그램입니다
#### - GetData.py

- 라즈베리 파이 기기에서 작동하는 프로그램으로 메인 PC에서 작동하는 SendWeatherInfo.py 프로그램에서 전달받은 날씨 정보와 미세먼지 정보를 화면에 출력하는 프로그램입니다.
- 진짜 IoT 기기라면 전달받은 정보를 처리하여 실내 온도를 조정하고 공기 청정을 수행하는 기능까지 구현해야했으나 일단은 컨셉을 전달하기 위해 단순하게 터미널창에 전달받은 정보를 출력하는 수준까지 구현했습니다.

##### 2020.06.10
주제의 모호함때문에 최종 발표에서는 제외하고 프로젝트를 진행하기로 했습니다.

## 시도했지만 실패한 요소
#### 1. 스미싱에 사용할 웹 페이지 및 웹쉘 구현
- 처음 선택한 주제였던 스미싱을 IoT 기기가 존재하는 무선랜의 주소 및 IoT 기기의 IP를 탈취하는 용도로 설정했습니다.
- 완성도 있는 프로젝트를 위해 
- 1) 실제 스미싱처럼 사용자를 조작된 웹 페이지로 유도한 다음
- 2) 웹쉘을 이용해서 사용자가 의도하지 않은 배치 파일을 다운받게 한 다음
- 3) 배치 파일을 실행하여 사용하고 있는 SSID와 PW를 얻은 다음 이를 공격자가 탈취하는 과정
- 1번 ~ 3번까지의 과정을 모두 구현하고 싶었지만 웹 프로그래밍과 웹쉘을 설치하는 것 까지는 능력의 부족으로 구현하지 못했습니다.
- 단순히 사용자 컴퓨터에 저장된 SSID와 PW를 출력하는 배치파일까지만 구현을 할 수 있었습니다.

#### 2. Netfilter 라이브러리와 Scapy 라이브러리

#### 3. DDoS

## 프로젝트 보완점(To-Do List)
#### 1. 명료한 프로젝트 주제

#### 2. 시나리오의 구체화

#### 3. 예외처리를 포함한 코드의 완성도

## 배운 점
#### 1. 라즈베리 파이 기기 세팅 및 실습

#### 2. 파이썬 소켓프로그래밍
